<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Support Us - Arcator.co.uk</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Google Fonts - Inter -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <!-- Link to theme_variables.css for centralized CSS variables if it exists -->
  <!-- Assuming theme_variables.css defines the CSS variables for different themes -->
  <link rel="stylesheet" href="theme_variables.css">

  <style>
    /* Base styles, will be overridden by CSS variables from themes.js */
    body {
      font-family: 'Inter', sans-serif;
      transition: background-color 0.3s ease, color 0.3s ease;
      background-color: var(--color-body-bg);
      color: var(--color-text-primary);
      background-image: linear-gradient(45deg, rgba(0,0,0,0.1) 25%, transparent 25%, transparent 50%, rgba(0,0,0,0.1) 50%, rgba(0,0,0,0.1) 75%, transparent 75%, transparent);
      background-size: 20px 20px;
      background-attachment: fixed;
    }

    /* Navbar specific styling using CSS variables (from navbar.html) */
    .navbar-bg {
      background-color: var(--color-bg-navbar, #111827); /* Fallback to dark theme default */
    }
    .navbar-text {
      color: var(--color-text-primary, #E5E7EB);
    }
    .navbar-link {
      color: var(--color-text-secondary); /* Default link color */
    }
    .navbar-link:hover {
      color: var(--color-text-primary); /* Hover link color */
      background-color: var(--color-bg-card); /* Slightly different background on hover */
    }
    .profile-pic-small {
      width: 32px;
      height: 32px;
      border-radius: 9999px; /* Tailwind's rounded-full */
      object-fit: cover;
    }

    /* Hero Banner styles - common for all themes, retains background image */
    .hero-banner {
      background-image: url('https://jylina.arcator.co.uk/standalone/img/creativespawn.png');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      min-height: 250px; /* Adjust height for inner pages */
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }
    .hero-banner::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5); /* Dark overlay for text readability */
      z-index: 1;
    }
    .hero-content {
      position: relative;
      z-index: 2;
      color: white;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.7); /* Text shadow for better readability on image */
    }

    /* Dynamic theme application for various elements */
    .bg-gray-800 {
      background-color: var(--color-bg-content-section) !important;
    }
    .bg-gray-700 {
      background-color: var(--color-bg-card) !important;
    }
    .bg-gray-900 {
      background-color: var(--color-bg-navbar) !important; /* For footer */
    }
    .text-gray-300 {
      color: var(--color-text-secondary) !important;
    }
    .text-gray-400 {
      color: var(--color-text-secondary) !important;
    }
    .text-gray-50 {
      color: var(--color-text-primary) !important; /* For logo/site title in navbar */
    }
    .text-red-400 {
      color: var(--color-heading-main) !important;
    }
    .text-blue-600 { /* For buttons */
      background-color: var(--color-button-blue-bg) !important;
      color: var(--color-button-text) !important;
    }
    .hover\:bg-blue-700:hover {
      background-color: var(--color-button-blue-hover) !important;
    }
    .bg-red-600 { /* For Patreon button */
      background-color: var(--color-button-red-bg) !important;
      color: var(--color-button-text) !important;
    }
    .hover\:bg-red-700:hover {
      background-color: var(--color-button-red-hover) !important;
    }
    .hover\:text-white:hover { /* For footer links */
      color: var(--color-text-primary) !important;
    }

    /* Table styling - using CSS variables */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
      margin-bottom: 1rem;
      background-color: var(--color-bg-card); /* Table background */
      color: var(--color-text-primary);
      border-radius: 0.5rem;
      overflow: hidden; /* Ensures rounded corners apply to content */
    }
    th, td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid var(--color-table-td-border); /* Dynamic border color */
    }
    th {
      background-color: var(--color-table-th-bg); /* Dynamic header background */
      color: var(--color-table-th-text); /* Dynamic header text color */
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    tr:nth-child(even) {
      background-color: var(--color-table-row-even-bg); /* Dynamic even row background */
    }
    tr:hover {
      background-color: var(--color-input-border); /* Lighter background on hover (using input border color) */
    }
  </style>
</head>
<body class="antialiased">
<!-- Navbar from navbar.html -->
<nav class="navbar-bg p-4 shadow-lg w-full fixed top-0 left-0 z-50">
  <div class="container mx-auto flex justify-between items-center">
    <!-- Logo/Site Title -->
    <a href="index.html" class="navbar-text text-2xl font-bold flex items-center gap-2">
      <svg class="h-6 w-6 text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1v-3m0 0l-1-1h-4l-1 1m0 0h-4a2 2 0 01-2-2V9a2 2 0 012-2h10a2 2 0 012 2v6a2 2 0 01-2 2H9.75z"></path>
      </svg>
      Arcator.co.uk
    </a>

    <!-- Navigation Links and User Info -->
    <div class="flex items-center space-x-4">
      <a href="about.html" class="text-gray-300 hover:text-gray-50 transition duration-300 ease-in-out text-lg font-medium rounded-md p-2 hover:bg-gray-800">About Us</a>
      <a href="servers.html" class="text-gray-300 hover:text-gray-50 transition duration-300 ease-in-out text-lg font-medium rounded-md p-2 hover:bg-gray-800">Servers</a>
      <a href="community.html" class="text-gray-300 hover:text-gray-50 transition duration-300 ease-in-out text-lg font-medium rounded-md p-2 hover:bg-gray-800">Community</a>
      <a href="interests.html" class="text-gray-300 hover:text-gray-50 transition duration-300 ease-in-out text-lg font-medium rounded-md p-2 hover:bg-gray-800">Interests</a>
      <a href="games.html" class="text-gray-300 hover:text-gray-50 transition duration-300 ease-in-out text-lg font-medium rounded-md p-2 hover:bg-gray-800">Games</a>
      <a href="https://wiki.arcator.co.uk/" target="_blank" rel="noopener noreferrer" class="text-gray-300 hover:text-gray-50 transition duration-300 ease-in-out text-lg font-medium rounded-md p-2 hover:bg-gray-800">Wiki</a>
      <a href="forms.html" class="text-gray-300 hover:text-gray-50 transition duration-300 ease-in-out text-lg font-medium rounded-md p-2 hover:bg-gray-800">Forms</a>
      <a href="index.html#join-us" class="text-gray-300 hover:text-gray-50 transition duration-300 ease-in-out text-lg font-medium rounded-md p-2 hover:bg-gray-800">Join Us</a>
      <a href="donations.html" class="text-gray-300 hover:text-gray-50 transition duration-300 ease-in-out text-lg font-medium rounded-md p-2 hover:bg-gray-800">Support Us</a>
      <!--User Profile Link - Hidden by default, shown by settings.html when logged in -->
      <a id="navbar-user-settings-link" href="settings.html" class="hidden items-center space-x-2 navbar-text navbar-link px-3 py-2 rounded-md font-medium">
        <img id="navbar-user-profile-pic" class="profile-pic-small" src="https://placehold.co/32x32/1F2937/E5E7EB?text=AV" alt="Profile Picture" onerror="this.onerror=null;this.src='https://placehold.co/32x32/1F2937/E5E7EB?text=AV';">
        <span id="navbar-user-display-name">Settings</span>
      </a>

      <!-- Sign In/Account Link - Visible by default, hidden by settings.html when logged in -->
      <a id="navbar-signin-link" href="sign.html" class="flex items-center space-x-2 navbar-text navbar-link px-3 py-2 rounded-md font-medium">
        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
        <span>Sign In</span>
      </a>
    </div>
  </div>
</nav>

<!-- Hero Section with Background Image -->
<section class="hero-banner rounded-b-lg shadow-xl" style="margin-top: 64px;"> <!-- Adjusted margin-top to account for fixed navbar height -->
  <div class="container mx-auto px-4 text-center hero-content">
    <h1 class="text-5xl md:text-6xl font-extrabold mb-4 leading-tight">Support Arcator.co.uk</h1>
    <p class="text-xl md:text-2xl mb-8">Your contributions help us keep the servers running!</p>
  </div>
</section>

<!-- Main Content Section: Donations -->
<section id="donations" class="py-16 bg-gray-800 rounded-lg shadow-inner mx-4 my-8">
  <div class="container mx-auto px-4">
    <h2 class="text-4xl font-bold text-red-400 text-center mb-10">How You Can Help</h2>
    <div class="max-w-3xl mx-auto text-lg leading-relaxed text-gray-300 space-y-6 text-center">
      <p>Running and maintaining a dedicated Minecraft server network requires significant resources, including server hosting, domain names, and development tools. Your generous donations help us cover these costs and allow us to continually improve the Arcator experience for everyone.</p>
      <p>We deeply appreciate any support you can offer. Every contribution, no matter how small, makes a big difference in keeping our community thriving.</p>
    </div>

    <div class="mt-12 overflow-x-auto rounded-lg shadow-xl">
      <table class="min-w-full">
        <thead>
        <tr>
          <th class="py-3 px-6 text-xl">Donation Method</th>
          <th class="py-3 px-6 text-xl">Details</th>
        </tr>
        </thead>
        <tbody>
        <tr>
          <td class="py-4 px-6 font-semibold text-white">Discord</td>
          <td class="py-4 px-6">
            <p>Join our Discord server to learn about other ways to support us, including in-game rewards or specific contribution drives.</p>
            <a href="https://discord.gg/GwArgw2" target="_blank" rel="noopener noreferrer" class="inline-block bg-blue-600 text-white font-bold py-3 px-8 rounded-full mt-6 hover:bg-blue-700 transition duration-300 ease-in-out transform hover:scale-105 shadow-lg">Join Our Discord to Donate</a>
          </td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>
</section>

<!-- Footer Section -->
<footer class="bg-gray-900 py-8 text-center text-gray-400 rounded-t-lg shadow-inner mt-8">
  <div class="container mx-auto px-4">
    <p>© 2012 - <span id="current-year-donations"></span> Arcator.co.uk. All rights reserved.</p>
    <p class="mt-2">Made with ❤️ for the Minecraft Community.</p>
    <div class="flex flex-wrap justify-center space-x-6 mt-4">
      <a href="privacy.html" class="hover:text-white transition duration-300 ease-in-out">Privacy Policy</a>
      <a href="terms.html" class="hover:text-white transition duration-300 ease-in-out">Terms of Service</a>
      <a href="https://wiki.arcator.co.uk/" target="_blank" rel="noopener noreferrer" class="hover:text-white transition duration-300 ease-in-out">Wiki</a>
      <a href="infrastructure.html" class="hover:text-white transition duration-300 ease-in-out">Infrastructure</a>
      <a href="admin_and_dev.html" class="hover:text-white transition duration-300 ease-in-out">Admin & Dev</a>
    </div>
  </div>
</footer>

<!-- Firebase SDKs and Main Script -->
<script type="module">
  import { setupThemesFirebase, applyTheme, getAvailableThemes } from './themes.js';
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
  import { getAuth, onAuthStateChanged, signInWithCustomToken, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
  import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

  // Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyCP5Zb1CRermAKn7p_S30E8qzCbvsMxhm4",
    authDomain: "arcator-web.firebaseapp.com",
    projectId: "arcator-web",
    storageBucket: "arcator-web.firebasestorage.app",
    messagingSenderId: "1033082068049",
    appId: "1:1033082068049:web:dd154c8b188bde1930ec70",
    measurementId: "G-DJXNT1L7CM"
  };

  const canvasAppId = typeof __app_id !== 'undefined' ? __app_id : null;
  const appId = canvasAppId || firebaseConfig.projectId || 'default-app-id';

  let app;
  let auth;
  let db;
  let firebaseReadyPromise; // Promise to ensure Firebase is fully initialized and authenticated

  const DEFAULT_THEME = 'dark';
  const DEFAULT_PROFILE_PIC = 'https://placehold.co/32x32/1F2937/E5E7EB?text=AV'; // Default placeholder

  /**
   * Fetches user profile data from Firestore.
   * @param {string} uid - The user's UID.
   * @returns {Promise<Object|null>} - User profile data or null if not found.
   */
  async function getUserProfileFromFirestore(uid) {
    await firebaseReadyPromise; // Ensure Firebase is initialized
    if (!db) {
      console.error("Firestore DB not initialized for getUserProfileFromFirestore.");
      return null;
    }
    const userDocRef = doc(db, `artifacts/${appId}/public/data/user_profiles`, uid);
    try {
      const docSnap = await getDoc(userDocRef);
      if (docSnap.exists()) {
        return docSnap.data();
      }
    } catch (error) {
      console.error("Error fetching user profile from Firestore:", error);
    }
    return null;
  }

  // Initialize Firebase and setup firebaseReadyPromise
  firebaseReadyPromise = new Promise((resolve) => {
    try {
      app = initializeApp(firebaseConfig);
      auth = getAuth(app);
      db = getFirestore(app);
      console.log("Firebase initialized successfully.");
      setupThemesFirebase(db, auth, appId); // Pass Firebase instances to themes.js

      // Critical: Ensure auth state is settled before resolving
      const unsubscribe = onAuthStateChanged(auth, (user) => {
        console.log("onAuthStateChanged triggered during initialization. User:", user ? user.uid : "none");
        unsubscribe(); // Unsubscribe after the first call

        // Perform initial sign-in if in Canvas and no user is already authenticated
        if (typeof __initial_auth_token !== 'undefined' && !user) {
          signInWithCustomToken(auth, __initial_auth_token)
            .then(() => console.log("DEBUG: Signed in with custom token from Canvas (donations page) during init."))
            .catch((error) => {
              console.error("ERROR: Error signing in with custom token (donations page) during init:", error);
              signInAnonymously(auth) // Fallback to anonymous sign-in if custom token fails
                .then(() => console.log("DEBUG: Signed in anonymously (donations page) after custom token failure during init."))
                .catch((anonError) => console.error("ERROR: Error signing in anonymously on donations page during init:", anonError));
            })
            .finally(() => resolve()); // Resolve promise after token attempt
        } else if (!user && typeof __initial_auth_token === 'undefined') {
          signInAnonymously(auth)
            .then(() => console.log("DEBUG: Signed in anonymously (no custom token) on donations page during init."))
            .catch((anonError) => console.error("ERROR: Error signing in anonymously on donations page during init:", anonError))
            .finally(() => resolve());
        }
        else {
          resolve(); // Resolve immediately if user is already authenticated or no token to use
        }
      });
    } catch (e) {
      console.error("Error initializing Firebase (initial block):", e);
      resolve(); // Resolve immediately on error to prevent infinite loading
    }
  });


  // Main execution logic on window load
  window.onload = async function() {
    // Wait for Firebase to be ready before proceeding
    await firebaseReadyPromise;

    // Set current year for footer
    document.getElementById('current-year-donations').textContent = new Date().getFullYear();

    // After everything is loaded and Firebase is ready, apply the user's theme and update navbar
    onAuthStateChanged(auth, async (user) => {
      let userThemePreference = null;
      let userProfile = null;
      if (user) {
        userProfile = await getUserProfileFromFirestore(user.uid);
        userThemePreference = userProfile?.themePreference;
      }
      // Apply the theme: user's preference, or 'dark' default
      const allThemes = await getAvailableThemes();
      const themeToApply = allThemes.find(t => t.id === userThemePreference) || allThemes.find(t => t.id === DEFAULT_THEME);
      applyTheme(themeToApply.id, themeToApply);

      // Update navbar visibility and user info
      const userSettingsLink = document.getElementById('navbar-user-settings-link');
      const signInLink = document.getElementById('navbar-signin-link');
      const userProfilePic = document.getElementById('navbar-user-profile-pic');
      const userDisplayName = document.getElementById('navbar-user-display-name');

      if (user) {
        // User is logged in
        signInLink.classList.add('hidden');
        userSettingsLink.classList.remove('hidden');

        if (userProfile) {
          userDisplayName.textContent = userProfile.displayName || 'Settings';
          userProfilePic.src = userProfile.profilePictureUrl || DEFAULT_PROFILE_PIC;
          console.log("Navbar profile pic URL from userProfile:", userProfile.profilePictureUrl);
        } else {
          // Fallback if profile not found but user is logged in
          userDisplayName.textContent = 'Settings';
          userProfilePic.src = DEFAULT_PROFILE_PIC;
          console.log("Navbar profile pic URL using DEFAULT_PROFILE_PIC (userProfile not found).");
        }
      } else {
        // User is not logged in
        signInLink.classList.remove('hidden');
        userSettingsLink.classList.add('hidden');
        console.log("User not logged in. Navbar profile pic will be default.");
      }
    });
  };
</script>
</body>
</html>
