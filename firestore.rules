// Firestore
Security
Rules
for Arcator
    // Copy and paste
this
into
Firebase
Console > Firestore
Database > Rules
tab

rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

                                        // Helper
functions
function
isSignedIn()
{
return request.auth.uid != null;
    }

function
isOwner(userId)
{
return request.auth.uid == userId;
    }

function
isAdmin()
{
return isSignedIn() & &
get( / databases /$(database) / documents / artifacts /$(request.auth.token.firebase.sign_in_provider == 'anonymous'
                                                         ? 'public': 'default') / public / data / user_profiles /$(
    request.auth.uid)).data.isAdmin == true;
}

function
isCreator(createdBy)
{
return request.auth.uid == createdBy;
}

// Public
read
access
to
forms, pages, themes(artifacts)
match / artifacts / {appId} / public / data / forms / {threadId}
{
allow
read:
if true;
allow
create:
if isSignedIn();
allow
update:
if isCreator(resource.data.createdBy) | | isAdmin();
allow
delete:
if isCreator(resource.data.createdBy) | | isAdmin();

// Comments
on
threads(submissions
subcollection)
match / submissions / {commentId}
{
    allow
read:
if true;
allow create: if
isSignedIn();
allow
update:
if isCreator(resource.data.authorId) | | isAdmin();
allow delete: if
isCreator(resource.data.authorId) | | isAdmin();
}
}

// Pages
match / artifacts / {appId} / public / data / pages / {pageId}
{
allow
read:
if true;
allow
create, update, delete:
if isAdmin();
}

// Themes
match / artifacts / {appId} / public / data / themes / {themeId}
{
      allow read: if true;
allow
write:
if isAdmin();
}

// User
profiles - public
readable, self - writable
match / artifacts / {appId} / public / data / user_profiles / {userId}
{
      allow read: if true;
allow
write:
if isOwner(userId) | | isAdmin();
}

// Admin
data - admin
only
match / artifacts / {appId} / public / data / admin / {document = **} {
allow
read, write:
if isAdmin();
}

// User - specific
DMs - only
accessible
to
participants
match / users / {userId} / dms / {dmId}
{
allow
read:
if isOwner(userId);
allow
create:
if isOwner(userId) & & request.resource.data.participants.hasAll([request.auth.uid]);
allow
update:
if isOwner(userId);
allow
delete:
if isOwner(userId);

// Messages in DMs
match / messages / {messageId}
{
    allow
read:
if isOwner(userId);
allow create: if
isOwner(userId) & & request.resource.data.sender == request.auth.uid;
allow
update:
if isOwner(userId) & & resource.data.sender == request.auth.uid;
allow delete: if
isOwner(userId) & & resource.data.sender == request.auth.uid;
}
}

// Generic
catch - all - deny
by
default
match / {document = **} {
allow
read, write:
if false;
}
}
}