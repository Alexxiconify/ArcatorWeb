rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
                                        // Helper
functions
function
isAuthenticated()
{
return request.auth != null;
    }

function
isOwner(userId)
{
return isAuthenticated() & & request.auth.uid == userId;
    }

function
isAdmin()
{
return isAuthenticated() & &
exists( / databases /$(database) / documents / artifacts / {appId} / public / data / user_profiles /$(
    request.auth.uid)) & &
get( / databases /$(database) / documents / artifacts / {appId} / public / data / user_profiles /$(
    request.auth.uid)).data.isAdmin == true;
}

// Allow
access
to
artifacts
collection
match / artifacts / {appId} / public / data / user_profiles / {userId}
{
allow
read:
if true;
allow
write:
if isOwner(userId) | | isAdmin();
}

match / artifacts / {appId} / public / data / themes / {themeId}
{
      allow read: if true;
allow
write:
if isAdmin();
}

match / artifacts / {appId} / public / data / user_themes / {userId}
{
allow
read:
if true;
allow
write:
if isOwner(userId) | | isAdmin();
}

match / artifacts / {appId} / public / data / admin / {document = **} {
allow
read, write:
if isAdmin();
}

match / artifacts / {appId} / public / data / pages / {pageId}
{
allow
read:
if true;
allow
write:
if isAdmin();

match / comments / {commentId}
{
    allow
read:
if true;
allow create: if
isAuthenticated();
allow
update, delete:
if isOwner(request.auth.uid) | | isAdmin();
}
}

// Allow
users
to
read
their
own
data
match / users / {userId}
{
allow
read:
if isOwner(userId);
allow
write:
if isAdmin();

match / settings / {document = **} {
    allow
read, write:
if isOwner(userId) | | isAdmin();
}
}

// System - wide
settings
match / settings / {settingId}
{
allow
read:
if true;
allow
write:
if isAdmin();
    }

// Forms and submissions
match / forms / {formId}
{
      allow read: if true;
allow
write:
if isAdmin();

match / submissions / {submissionId}
{
    allow
read:
if isAdmin();
allow create: if
isAuthenticated();
allow
update, delete:
if isAdmin();
}
    }
  }
}