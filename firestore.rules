rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

                                        // Forms / Threads - allow
authenticated
users
to
read and create
match / artifacts / {appId} / public / data / forms / {threadId}
{
      allow read: if true;
allow create: if
request.auth != null;
allow
update:
if request.auth != null;
allow delete: if
request.auth.uid == resource.data.createdBy;

// Comments / Submissions
subcollection - allow
anyone
signed in to
create
match / submissions / {commentId}
{
    allow
read:
if true;
allow create: if
request.auth != null;
allow
update:
if request.auth.uid == resource.data.authorId;
allow delete: if
request.auth.uid == resource.data.authorId;
}
}

// User
profiles - public
readable, self - writable
match / artifacts / {appId} / public / data / user_profiles / {userId}
{
    allow
read:
if true;
allow write: if
request.auth.uid == userId;
}

// Pages - public
read
only
match / artifacts / {appId} / public / data / pages / {pageId}
{
      allow read: if true;
allow write: if
false;
}

// Themes - public
read
only
match / artifacts / {appId} / public / data / themes / {themeId}
{
    allow
read:
if true;
allow write: if
false;
}

// User - specific
DMs - only
accessible
to
participants
match / users / {userId} / dms / {dmId}
{
    allow
read:
if request.auth.uid == userId;
allow create: if
request.auth.uid == userId;
allow
update:
if request.auth.uid == userId;
allow delete: if
request.auth.uid == userId;

// Messages in DMs
match / messages / {messageId}
{
    allow
read:
if request.auth.uid == userId;
allow create: if
request.auth.uid == userId;
allow
update:
if request.auth.uid == userId;
allow delete: if
request.auth.uid == userId;
}
}

// Users
collection
for profile lookups
match / users / {userId} {
allow read: if
true;
allow
create:
if request.auth.uid == userId;
allow update: if
request.auth.uid == userId;
allow
delete:
if request.auth.uid == userId;
}

// Catch-all deny
match / {document= **} {
allow read, write: if
false;
}
}
}