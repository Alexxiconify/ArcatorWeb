<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin - Arcator.co.uk</title>
    <!-- Link to master.css for all styles -->
    <link href="master.css" rel="stylesheet" />
    <!-- Google Fonts - Inter and others -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Roboto+Mono:wght@400;700&family=Open+Sans:wght@400;700&display=swap"
      rel="stylesheet"/>
    <!-- Favicon link -->
    <link rel="icon" type="image/png" href="favicon.png" />
    <!-- EmailJS Script -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
  </head>
  <body class="antialiased font-family-inter">
    <!-- Navbar Placeholder -->
    <div id="navbar-placeholder" class="w-full absolute top-0 left-0"></div>

    <!-- Hero Section -->
    <section class="hero-banner rounded-b-lg shadow-xl">
      <div class="container mx-auto px-4 text-center hero-content">
        <h1 id="hero-title" class="text-5xl md:text-6xl font-extrabold mb-4 leading-tight text-heading-main">
          Admin
        </h1>
        <p id="hero-subtitle" class="text-xl md:text-2xl mb-8 text-heading-card">
          Insights into Arcator's operations and ongoing projects.
        </p>
      </div>
    </section>

    <!-- Admin Section Content -->
    <section class="py-16 bg-content-section rounded-lg shadow-inner mx-4 my-8" id="admin-dev">
      <div class="container mx-auto px-4">
        <!-- Login Required Message / Redirect -->
        <div class="text-center bg-card p-8 rounded-lg shadow-md mb-8" id="login-required-message" hidden>
          <h2 class="text-4xl font-bold text-heading-main mb-6">
            Access Denied
          </h2>
          <p class="text-lg text-text-secondary mb-8">
            You must be logged in to access this page. Some sections require
            administrator privileges.
          </p>
          <a class="btn-primary btn-blue" href="users.html">Login / Sign Up</a>
        </div>

        <!-- Admin Guides section (first) -->
        <div class="settings-section w-full max-w-full mb-8">
          <div class="settings-card w-full max-w-full mb-8">
            <details open>
              <summary class="text-xl font-bold text-heading-card flex items-center gap-2 cursor-pointer select-none justify-center text-center">
                Admin Guides
              </summary>
              <div class="mt-4 w-full flex flex-col items-start">
                <p class="mb-2">
                  Guides for sysadmin tasks, SSH, and server management:
                </p>
                <ul class="list-disc ml-6 mb-2">
                  <li>
                    <a
                      href="https://wiki.arcator.co.uk/en/Sysadmin"
                      target="_blank"
                      rel="noopener noreferrer"
                      class="text-link hover:underline"
                      >Sysadmin Wiki (SSH, server setup, keys, Mosh, etc.)</a
                    >
                  </li>
                  <li>
                    <a
                      href="https://docs.google.com/document/d/1WvxTStjkBbQh9dp-59v1jJbaLPuofrnk_4N12mSMFo4/edit?tab=t.0"
                      target="_blank"
                      rel="noopener noreferrer"
                      class="text-link hover:underline"
                      >Arcator Internal Docs (Growth plans, admin notes)</a
                    >
                  </li>
                  <li>
                    <a
                      href="https://docs.google.com/document/d/1jKN_u7avWxKKHo89VrR9TCtFX5Zv1A7DCgnsJtVSID4/edit"
                      target="_blank"
                      rel="noopener noreferrer"
                      class="text-link hover:underline"
                      >Vann's Command Guide</a
                    >
                  </li>
                </ul>
                <p class="text-xs text-text-secondary">
                  See wiki for SSH key setup, Termius config, and host details.
                  Use Mosh for high-speed, port 220, user <b>mcsa</b>.
                </p>
              </div>
            </details>
          </div>
        </div>

        <!-- Admin Panel Sections -->
        <div id="admin-content">
          <!-- User Management Section -->
          <div class="settings-section w-full max-w-full mb-8">
            <div class="settings-card w-full max-w-full mb-8">
              <details open>
                <summary class="text-xl font-bold text-heading-card flex items-center gap-2 cursor-pointer select-none justify-center text-center">
                  User Management
                </summary>
                <div class="mt-4 w-full flex flex-col items-start">
                  <div class="w-full">
                    <table class="w-full text-left table-auto text-xs">
                      <thead>
                        <tr class="bg-table-th-bg">
                          <th class="px-2 py-1 text-table-th-text text-xs">UID</th>
                          <th class="px-2 py-1 text-table-th-text text-xs">Display Name</th>
                          <th class="px-2 py-1 text-table-th-text text-xs">Email</th>
                          <th class="px-2 py-1 text-table-th-text text-xs">Theme</th>
                          <th class="px-2 py-1 text-table-th-text text-xs">Actions</th>
                        </tr>
                      </thead>
                      <tbody id="user-list-tbody">
                        <tr>
                          <td class="text-center py-4 text-text-secondary text-xs" colspan="5">
                            Loading users...
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </details>
            </div>
          </div>

          <!-- Direct Messages History Section -->
          <div class="settings-section w-full max-w-full mb-8">
            <div class="settings-card w-full max-w-full mb-8">
              <details open>
                <summary class="text-xl font-bold text-heading-card flex items-center gap-2 cursor-pointer select-none justify-center text-center">
                  Direct Messages History
                </summary>
                <div class="mt-4 w-full flex flex-col items-start">
                  <div class="w-full">
                    <table class="w-full text-left table-auto text-xs">
                      <thead>
                        <tr class="bg-table-th-bg">
                          <th class="px-2 py-1 text-table-th-text text-xs">DATE</th>
                          <th class="px-2 py-1 text-table-th-text text-xs">FROM</th>
                          <th class="px-2 py-1 text-table-th-text text-xs">TO</th>
                          <th class="px-2 py-1 text-table-th-text text-xs">SUBJECT</th>
                          <th class="px-2 py-1 text-table-th-text text-xs">CONTENT</th>
                          <th class="px-2 py-1 text-table-th-text text-xs">ACTIONS</th>
                        </tr>
                      </thead>
                      <tbody id="dm-history-tbody">
                        <tr>
                          <td class="text-center py-4 text-text-secondary text-xs" colspan="6">
                            No DMs found.
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </details>
            </div>
          </div>

          <!-- Forms Management Section -->
          <div class="settings-section w-full max-w-full mb-8">
            <div class="settings-card w-full max-w-full mb-8">
              <details open>
                <summary class="text-xl font-bold text-heading-card flex items-center gap-2 cursor-pointer select-none justify-center text-center">
                  Forms Management (Theme → Thread → Comment)
                </summary>
                <div class="mt-4 w-full flex flex-col items-start">
                  <div class="w-full">
                    <table class="w-full text-left table-auto text-xs">
                      <thead>
                        <tr class="bg-table-th-bg">
                          <th class="px-2 py-1 text-table-th-text text-xs">THEME</th>
                          <th class="px-2 py-1 text-table-th-text text-xs">DESCRIPTION</th>
                          <th class="px-2 py-1 text-table-th-text text-xs">THREADS</th>
                          <th class="px-2 py-1 text-table-th-text text-xs">COMMENTS</th>
                          <th class="px-2 py-1 text-table-th-text text-xs">ACTIONS</th>
                        </tr>
                      </thead>
                      <tbody id="form-submissions-tbody">
                        <tr>
                          <td class="text-center py-4 text-text-secondary text-xs" colspan="5">
                            No forms found.
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </details>
            </div>
          </div>

          <!-- Temporary Pages Section -->
          <div class="settings-section w-full max-w-full mb-8">
            <div class="settings-card w-full max-w-full mb-8">
              <details open>
                <summary class="text-xl font-bold text-heading-card flex items-center gap-2 cursor-pointer select-none justify-center text-center">
                  Temporary Pages
                </summary>
                <div class="mt-4 w-full flex flex-col items-start">
                  <form id="create-temp-page-form" class="space-y-4 w-full">
                    <div class="input-field w-full">
                      <label for="temp-page-title" class="form-label">Page Title:</label>
                      <input id="temp-page-title" placeholder="Enter page title" type="text" class="form-input w-full" />
                    </div>
                    <div class="input-field w-full">
                      <label for="temp-page-content" class="form-label">Page Content (HTML allowed):</label>
                      <textarea id="temp-page-content" placeholder="Write your page content here... Use HTML for styling!" class="form-input w-full h-32"></textarea>
                    </div>
                    <div class="flex items-center gap-4 mb-4">
                      <div class="checkbox-container mb-0">
                        <input type="checkbox" id="temp-page-allow-comments-create" class="form-checkbox" checked />
                        <label for="temp-page-allow-comments-create">Allow Comments</label>
                      </div>
                      <button type="submit" class="btn-primary btn-blue ml-0">Create Temp Page</button>
                    </div>
                  </form>
                  
                  <h4 class="text-xl font-semibold text-text-primary mt-6 mb-3">Existing Temporary Pages:</h4>
                  <div id="temp-page-list" class="overflow-x-auto w-full">
                    <table class="w-full text-left table-auto text-xs">
                      <thead>
                        <tr class="bg-table-th-bg">
                          <th class="px-2 py-1 text-table-th-text text-xs">TITLE</th>
                          <th class="px-2 py-1 text-table-th-text text-xs">ACTIONS</th>
                        </tr>
                      </thead>
                      <tbody id="temp-pages-tbody">
                        <tr>
                          <td class="text-center py-4 text-text-secondary text-xs" colspan="2">
                            No temporary pages found.
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </details>
            </div>
          </div>

          <!-- Email Management Section -->
          <div class="settings-section w-full max-w-full mb-8">
            <div class="settings-card w-full max-w-full mb-8">
              <details open>
                <summary class="text-xl font-bold text-heading-card flex items-center gap-2 cursor-pointer select-none justify-center text-center">
                  Email Management
                </summary>
                <div class="mt-4 w-full flex flex-col items-start">
                  <!-- Compose Email Section -->
                  <div class="w-full mb-6">
                    <h4 class="text-lg font-semibold text-heading-card mb-4">Compose Email</h4>
                    <form id="email-compose-form" class="space-y-4">
                      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="input-field">
                          <label for="email-recipient-type" class="form-label">Recipient Type:</label>
                          <select id="email-recipient-type" class="form-input w-full"></select>
                        </div>
                        <div class="input-field">
                          <label for="email-template" class="form-label">Email Template:</label>
                          <select id="email-template" class="form-input w-full"></select>
                        </div>
                      </div>

                      <div id="custom-recipients-section" class="input-field" style="display: none">
                        <label for="email-recipients" class="form-label">Select Recipients:</label>
                        <div class="bg-input-bg border border-input-border rounded-lg p-3 max-h-48 overflow-y-auto">
                          <div id="email-recipients-list" class="space-y-2">
                            <!-- Recipients will be populated here -->
                          </div>
                        </div>
                      </div>

                      <div class="input-field">
                        <label for="email-subject" class="form-label">Subject:</label>
                        <input id="email-subject" type="text" placeholder="Enter email subject" class="form-input w-full" />
                      </div>

                      <div class="input-field">
                        <label for="email-content" class="form-label">Email Content:</label>
                        <textarea id="email-content" placeholder="Write your email content here..." class="form-input w-full h-32"></textarea>
                      </div>

                      <div class="flex space-x-2">
                        <button type="submit" class="btn-primary">Send Email</button>
                        <button type="button" id="preview-email-btn" class="btn-primary">Preview</button>
                        <button type="button" id="save-draft-btn" class="btn-primary">Save Draft</button>
                      </div>
                    </form>
                  </div>

                  <!-- Email History Section -->
                  <div class="w-full">
                    <h4 class="text-lg font-semibold text-heading-card mb-4">Email History</h4>
                    <div class="w-full">
                      <table class="w-full text-left table-auto text-xs">
                        <thead>
                          <tr class="bg-table-th-bg">
                            <th class="px-2 py-1 text-table-th-text text-xs">DATE</th>
                            <th class="px-2 py-1 text-table-th-text text-xs">RECIPIENTS</th>
                            <th class="px-2 py-1 text-table-th-text text-xs">SUBJECT</th>
                            <th class="px-2 py-1 text-table-th-text text-xs">STATUS</th>
                            <th class="px-2 py-1 text-table-th-text text-xs">METHOD</th>
                            <th class="px-2 py-1 text-table-th-text text-xs">ACTIONS</th>
                          </tr>
                        </thead>
                        <tbody id="email-history-tbody">
                          <tr>
                            <td class="text-center py-4 text-text-secondary text-xs" colspan="6">
                              No emails sent yet.
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </details>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Message Box Element -->
    <div id="message-box" class="message-box"></div>

    <!-- Custom Confirmation Modal (for delete operations) -->
    <div id="custom-confirm-modal" class="custom-confirm-modal">
      <div class="modal-content">
        <span class="close-button">&times;</span>
        <p class="mb-4 text-lg" id="confirm-message"></p>
        <p class="mb-6 text-sm text-text-secondary" id="confirm-submessage"></p>
        <button id="confirm-yes" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-full mr-4">
          Yes
        </button>
        <button id="confirm-no" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-full">
          Cancel
        </button>
      </div>
    </div>

    <!-- Footer Section -->
    <div id="footer-placeholder"></div>

    <!-- Consolidated JavaScript -->
    <script type="module">
      import { initializePage } from './core.js';
      import { initializeAdminPanel } from './admin.js';
      
      // Initialize the admin page
      initializePage('Admin', 'current-year-admin');
      
      // Initialize admin-specific functionality
      document.addEventListener('DOMContentLoaded', () => {
        initializeAdminPanel();
      });
    </script>
  </body>
</html>
