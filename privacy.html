<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Legal - Arcator.co.uk</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Google Fonts - Inter -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <!-- Link to theme_variables.css for centralized CSS variables -->
  <link rel="stylesheet" href="theme_variables.css">
  <!-- Link to common.css for shared styles -->
  <link href="common.css" rel="stylesheet">
  <!-- Favicon link -->
  <link rel="icon" type="image/png" href="favicon.png">
    <style>
      /* Base styles, will be overridden by CSS variables from themes.js */
      body {
        font-family: 'Inter', sans-serif;
        transition: background-color 0.3s ease, color 0.3s ease;
        background-color: var(--color-body-bg);
        color: var(--color-text-primary);
      }
      /* Hero Banner styles - common for all themes, retains background image */
      .hero-banner {
        background-image: url('https://jylina.arcator.co.uk/standalone/img/creativespawn.png');
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        min-height: 400px;
        /* Increased height for visual impact */
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        overflow: hidden;
      }
      .hero-banner::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        /* Dark overlay for text readability */
        z-index: 1;
      }
      .hero-content {
        position: relative;
        z-index: 2;
        color: white;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
      }
    
      /* Feature card specific styling */
      .feature-card {
        border-radius: 0.75rem;
        padding: 2rem;
        box-shadow: 0 10px 15px rgba(0, 0, 0, 0.3);
        transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
      }
    
      .feature-card:hover {
        transform: translateY(-5px) scale(1.02);
        box-shadow: 0 15px 20px rgba(0, 0, 0, 0.5);
      }
    
      .minecraft-ip-box {
        border: 2px solid var(--color-border-ip-box);
        box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
      }
    
      .text-white {
        /* Ensure white text remains white where explicitly needed, e.g., IP addresses */
        color: white !important;
      }
    
      /* Content section styling */
      .content-section {
        border-radius: 0.75rem;
        box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        padding: 2rem;
        margin: 2rem 1rem;
      }
    
      .content-card {
        border: 1px solid var(--color-input-border);
        border-radius: 0.75rem;
        padding: 1.5rem;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        transition: all 0.2s ease-in-out;
      }
    
      .content-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2);
      }
    
      /* List styling */
      .feature-list {
        list-style-type: disc;
        list-style-position: inside;
      }
    
      .feature-list li {
        margin-bottom: 0.5rem;
        line-height: 1.6;
      }
    
      .feature-list .highlight {
        font-weight: 600;
      }
    
      .tab-container {
        display: flex;
        justify-content: center;
        margin-bottom: 2rem;
        border-bottom: 2px solid var(--color-input-border);
      }
    
      .tab-button {
        border: none;
        padding: 1rem 2rem;
        margin: 0 0.5rem;
        border-radius: 0.75rem 0.75rem 0 0;
        cursor: pointer;
        font-weight: 600;
        font-size: 1.1rem;
        transition: all 0.3s;
        border-bottom: 3px solid transparent;
      }
    
      .tab-button.active {
        border-bottom-color: var(--color-link);
      }
    
      .tab-content {
        display: none;
      }
    
      .tab-content.active {
        display: block;
      }
    
      @media (max-width: 768px) {
        .tab-container {
          flex-direction: column;
          align-items: center;
        }
    
        .tab-button {
          margin: 0.25rem 0;
          border-radius: 0.5rem;
          width: 100%;
          max-width: 300px;
        }
    
        .tab-button.active {
          border-bottom-color: transparent;
        }
      }
    </style>
</head>
<body class="antialiased">
<!-- Navbar Placeholder -->
<div id="navbar-placeholder" class="w-full absolute top-0 left-0"></div>

<!-- Hero Section -->
<section class="hero-banner rounded-b-lg shadow-xl" style="margin-top: 64px;">
  <div class="container mx-auto px-4 text-center hero-content">
    <h1 class="text-5xl md:text-6xl font-extrabold mb-4 leading-tight">Legal Information</h1>
    <p class="text-xl md:text-2xl mb-8">Privacy Policy & Terms of Service</p>
  </div>
</section>

<!-- Main Content Section -->
<section class="py-16 bg-content-section rounded-lg shadow-inner mx-4 my-8">
  <div class="container mx-auto px-4">
    <!-- Tab Navigation -->
    <div class="legal-tabs">
      <button class="tab-button active" onclick="showTab('privacy')">Privacy Policy</button>
      <button class="tab-button" onclick="showTab('terms')">Terms of Service</button>
    </div>

    <!-- Privacy Policy Tab -->
    <div class="tab-content active" id="privacy-tab">
      <div class="legal-content">
        <h2>Privacy Policy</h2>
        <p>Last updated: December 2024</p>

        <h3>Information We Collect</h3>
        <p>We collect information you provide directly to us, such as when you create an account, contact us, or
          participate in our community features.</p>

        <h3>How We Use Your Information</h3>
        <ul>
          <li>To provide and maintain our services</li>
          <li>To communicate with you about updates and changes</li>
          <li>To ensure the security and integrity of our platform</li>
          <li>To improve our services and user experience</li>
        </ul>

        <h3>Information Sharing</h3>
        <p>We do not sell, trade, or otherwise transfer your personal information to third parties without your consent,
          except as described in this policy.</p>

        <h3>Data Security</h3>
        <p>We implement appropriate security measures to protect your personal information against unauthorized access,
          alteration, disclosure, or destruction.</p>

        <h3>Your Rights</h3>
        <p>You have the right to access, update, or delete your personal information. You can manage your account
          settings through your profile page.</p>

        <h3>Contact Us</h3>
        <p>If you have any questions about this Privacy Policy, please contact us through our Discord server or website
          contact forms.</p>
      </div>
    </div>

    <!-- Terms of Service Tab -->
    <div class="tab-content" id="terms-tab">
      <div class="legal-content">
        <h2>Terms of Service</h2>
        <p>Last updated: December 2024</p>

        <h3>Acceptance of Terms</h3>
        <p>By accessing and using Arcator.co.uk, you accept and agree to be bound by the terms and provision of this
          agreement.</p>

        <h3>Use License</h3>
        <p>Permission is granted to temporarily access the materials on Arcator.co.uk for personal, non-commercial
          transitory viewing only.</p>

        <h3>User Conduct</h3>
        <ul>
          <li>Respect other users and community members</li>
          <li>Follow server rules and guidelines</li>
          <li>Do not engage in harassment or harmful behavior</li>
          <li>Maintain appropriate language and content</li>
        </ul>

        <h3>Account Responsibilities</h3>
        <p>You are responsible for maintaining the confidentiality of your account and password. You agree to accept
          responsibility for all activities that occur under your account.</p>

        <h3>Content Guidelines</h3>
        <p>Users may submit content to our platform. You retain ownership of your content but grant us a license to use,
          modify, and distribute it in connection with our services.</p>

        <h3>Prohibited Activities</h3>
        <ul>
          <li>Violating any applicable laws or regulations</li>
          <li>Attempting to gain unauthorized access to our systems</li>
          <li>Interfering with the proper functioning of our services</li>
          <li>Sharing malicious content or software</li>
        </ul>

        <h3>Termination</h3>
        <p>We may terminate or suspend your account and access to our services at any time, with or without cause, with
          or without notice.</p>

        <h3>Limitation of Liability</h3>
        <p>Arcator.co.uk shall not be liable for any indirect, incidental, special, consequential, or punitive damages
          resulting from your use of our services.</p>

        <h3>Changes to Terms</h3>
        <p>We reserve the right to modify these terms at any time. We will notify users of any material changes through
          our website or Discord server.</p>

        <h3>Contact Information</h3>
        <p>For questions about these Terms of Service, please contact us through our Discord server or website contact
          forms.</p>
      </div>
    </div>
  </div>
</section>

<!-- Footer Section -->
<div id="footer-placeholder"></div>

<!-- JavaScript for tab functionality -->
<script>
  function showTab(tabName) {
    // Hide all tab contents
    const tabContents = document.querySelectorAll('.tab-content');
    tabContents.forEach(content => content.classList.remove('active'));

    // Remove active class from all tab buttons
    const tabButtons = document.querySelectorAll('.tab-button');
    tabButtons.forEach(button => button.classList.remove('active'));

    // Show selected tab content
    document.getElementById(tabName + '-tab').classList.add('active');

    // Add active class to clicked button
    event.target.classList.add('active');
  }
</script>

<!-- Firebase SDKs and Main Script -->
<script type="module">
  import {
    auth,
    getUserProfileFromFirestore,
    firebaseReadyPromise,
    DEFAULT_PROFILE_PIC,
    DEFAULT_THEME_NAME
  } from './firebase-init.js';
  import { loadNavbar, loadFooter } from './navbar.js';
  import { getAvailableThemes, applyTheme } from './themes.js';

  window.showTab = function (tabName) {
    const tabContents = document.querySelectorAll('.tab-content');
    tabContents.forEach(content => content.classList.remove('active'));
    const tabButtons = document.querySelectorAll('.tab-button');
    tabButtons.forEach(button => button.classList.remove('active'));
    document.getElementById(tabName + '-tab').classList.add('active');
    event.target.classList.add('active');

    // Load interests data when census tab is shown
    if (tabName === 'census' && interestsData.length === 0) {
      loadInterestsData();
    }
  };

  firebaseReadyPromise.then(async () => {
    let userProfile = null;
    if (auth.currentUser) {
      userProfile = await getUserProfileFromFirestore(auth.currentUser.uid);
    }
    await loadNavbar(auth.currentUser, userProfile, DEFAULT_PROFILE_PIC, "dark");
    loadFooter('current-year-legal');

    // Apply user's theme preference (fix: always use userProfile.themePreference if present)
    const userThemePreference = userProfile?.themePreference;
    const allThemes = await getAvailableThemes();
    const themeToApply = allThemes.find(t => t.id === userThemePreference) || allThemes.find(t => t.id === "dark");
    if (themeToApply) {
      applyTheme(themeToApply.id, themeToApply);
      console.log(`Legal page: Applied theme ${themeToApply.id} (${themeToApply.name})`);
    }

    setTimeout(async () => {
      if (typeof window.forceRefreshNavbarState === 'function') {
        await window.forceRefreshNavbarState();
      }
    }, 500);
  });

  // Community Interests Table Functionality
  let interestsData = [];
  let filteredData = [];
  let currentSort = { column: 'interest', direction: 'asc' };

  // Load interests data from JSON file
  async function loadInterestsData() {
    const loadingEl = document.getElementById('interests-loading');
    const errorEl = document.getElementById('interests-error');
    const tableContainer = document.getElementById('interests-table-container');

    try {
      loadingEl.classList.remove('hidden');
      errorEl.classList.add('hidden');
      tableContainer.classList.add('hidden');

      console.log('[DEBUG] Loading census data from JSON file...');

      // Fetch from local JSON file
      const response = await fetch('census-data.json');

      if (!response.ok) {
        throw new Error(`Failed to fetch census data: ${response.status}`);
      }

      const jsonData = await response.json();
      console.log('[DEBUG] Successfully loaded census data:', jsonData.data.length, 'items');

      interestsData = jsonData.data;

    } catch (error) {
      console.warn('[DEBUG] Using fallback census data due to error:', error);
      console.log('[DEBUG] Error details:', error.message);

      // Use fallback data if available
      interestsData = [];
    }

    // Initialize the table
    initializeInterestsTable();
  }

  // Initialize the interests table
  function initializeInterestsTable() {
    const loadingEl = document.getElementById('interests-loading');
    const tableContainer = document.getElementById('interests-table-container');

    loadingEl.classList.add('hidden');
    tableContainer.classList.remove('hidden');

    // Populate category filter
    populateCategoryFilter();

    // Render initial table
    renderInterestsTable();

    // Setup event listeners
    setupInterestsEventListeners();
  }

  // Populate category filter dropdown
  function populateCategoryFilter() {
    const categories = [...new Set(interestsData.map(item => item.category))].sort();
    const filterEl = document.getElementById('interests-category-filter');

    filterEl.innerHTML = '<option value="">All Categories</option>';
    categories.forEach(category => {
      const option = document.createElement('option');
      option.value = category;
      option.textContent = category;
      filterEl.appendChild(option);
    });
  }

  // Render the interests table
  function renderInterestsTable() {
    const tbody = document.getElementById('interests-table-body');
    const countEl = document.getElementById('interests-count');
    const noResultsEl = document.getElementById('interests-no-results');

    if (filteredData.length === 0) {
      tbody.innerHTML = '';
      noResultsEl.classList.remove('hidden');
      countEl.textContent = '0';
      return;
    }

    noResultsEl.classList.add('hidden');
    countEl.textContent = filteredData.length;

    tbody.innerHTML = filteredData.map(item => {
      // Create member count badge with color coding
      const getMemberBadgeClass = (count) => {
        if (count >= 5) return 'bg-green-100 text-green-800';
        if (count >= 3) return 'bg-blue-100 text-blue-800';
        if (count >= 1) return 'bg-yellow-100 text-yellow-800';
        return 'bg-gray-100 text-gray-800';
      };

      const memberBadgeClass = getMemberBadgeClass(item.members);

      return `
        <tr class="hover:bg-table-row-even-bg transition-colors">
          <td class="px-6 py-4 text-text-primary font-medium">${escapeHtml(item.interest)}</td>
          <td class="px-6 py-4">
            <span class="inline-block px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm font-medium">
              ${escapeHtml(item.category)}
            </span>
          </td>
          <td class="px-6 py-4">
            <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium ${memberBadgeClass}">
              <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path>
              </svg>
              ${item.members || '0'}
            </span>
          </td>
          <td class="px-6 py-4 text-text-secondary">${escapeHtml(item.description || '')}</td>
        </tr>
      `;
    }).join('');
  }

  // Setup event listeners for search and filtering
  function setupInterestsEventListeners() {
    const searchEl = document.getElementById('interests-search');
    const categoryFilterEl = document.getElementById('interests-category-filter');
    const retryBtn = document.getElementById('retry-interests-btn');

    // Search functionality
    searchEl.addEventListener('input', debounce(() => {
      applyFilters();
    }, 300));

    // Category filter
    categoryFilterEl.addEventListener('change', () => {
      applyFilters();
    });

    // Retry button
    retryBtn.addEventListener('click', () => {
      console.log('[DEBUG] Retry button clicked, reloading census data...');
      // Clear existing data and reload
      interestsData = [];
      filteredData = [];
      loadInterestsData();
    });
  }

  // Apply search and filter
  function applyFilters() {
    const searchTerm = document.getElementById('interests-search').value.toLowerCase();
    const categoryFilter = document.getElementById('interests-category-filter').value;

    filteredData = interestsData.filter(item => {
      const matchesSearch = !searchTerm ||
        item.interest.toLowerCase().includes(searchTerm) ||
        item.description.toLowerCase().includes(searchTerm) ||
        item.category.toLowerCase().includes(searchTerm);

      const matchesCategory = !categoryFilter || item.category === categoryFilter;

      return matchesSearch && matchesCategory;
    });

    // Apply current sort
    sortData(currentSort.column, currentSort.direction);
    renderInterestsTable();
  }

  // Sort table data
  function sortData(column, direction) {
    filteredData.sort((a, b) => {
      let aVal = a[column] || '';
      let bVal = b[column] || '';

      // Handle numeric values
      if (column === 'members') {
        aVal = parseInt(aVal) || 0;
        bVal = parseInt(bVal) || 0;
      } else {
        aVal = aVal.toString().toLowerCase();
        bVal = bVal.toString().toLowerCase();
      }

      if (direction === 'asc') {
        return aVal > bVal ? 1 : -1;
      } else {
        return aVal < bVal ? 1 : -1;
      }
    });
  }

  // Global sort function for table headers
  window.sortTable = function (column) {
    if (currentSort.column === column) {
      currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
    } else {
      currentSort.column = column;
      currentSort.direction = 'asc';
    }

    sortData(currentSort.column, currentSort.direction);
    renderInterestsTable();
  };

  // Utility functions
  function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
  }

  function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
      const later = () => {
        clearTimeout(timeout);
        func(...args);
      };
      clearTimeout(timeout);
      timeout = setTimeout(later, wait);
    };
  }
</script>
</body>
</html>
