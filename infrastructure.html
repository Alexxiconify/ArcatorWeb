<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Infrastructure - Arcator.co.uk</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Google Fonts - Inter -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <!-- Link to the CSS variables -->
  <link rel="stylesheet" href="theme_variables.css">
</head>
<body class="antialiased">
<!-- Navbar Placeholder -->
<div id="navbar-placeholder" class="w-full absolute top-0 left-0"></div>

<!-- Hero Section with Background Image -->
<section class="hero-banner rounded-b-lg shadow-xl">
  <div class="container mx-auto px-4 text-center hero-content">
    <h1 class="text-5xl md:text-6xl font-extrabold mb-4 leading-tight">Arcator Infrastructure</h1>
    <p class="text-xl md:text-2xl mb-8">Powering Your Minecraft Experience</p>
  </div>
</section>

<!-- Main Content Section: Infrastructure Overview -->
<section class="py-16 bg-gray-800 rounded-lg shadow-inner mx-4 my-8">
  <div class="container mx-auto px-4">
    <h2 class="text-4xl font-bold text-red-400 text-center mb-10">Our Robust Network Setup</h2>
    <div class="max-w-4xl mx-auto text-lg leading-relaxed text-gray-300 space-y-6 text-center">
      <p>Arcator's stability and performance are built upon a foundation of dedicated and well-maintained server infrastructure. We utilize a blend of powerful machines and strategic network configurations to ensure a seamless and low-latency experience for all our players across various Minecraft servers and services.</p>
      <p>Our setup is designed for efficiency, reliability, and scalability, allowing us to host diverse gamemodes, critical background services, and provide robust redundancy measures.</p>
    </div>

    <div class="mt-12 overflow-x-auto rounded-lg shadow-xl">
      <table class="min-w-full bg-gray-700">
        <thead>
        <tr>
          <th class="py-3 px-6 text-xl">Hostname</th>
          <th class="py-3 px-6 text-xl">Primary Role</th>
        </tr>
        </thead>
        <tbody>
        <tr><td>jylina</td><td>Main Minecraft Server Host (s1)</td></tr>
        <tr><td>thoth</td><td>Raspberry Pi Minecraft Server (s2) / Backup Services</td></tr>
        <tr><td>sputnik</td><td>Web Server / Load Balancer (s9)</td></tr>
        </tbody>
      </table>
    </div>
    <p class="text-lg mt-12 text-gray-400 text-center">This setup allows us to efficiently manage different aspects of the network, from hosting Minecraft servers to handling critical background services and providing redundancy.</p>
  </div>
</section>

<!-- Footer Section -->
<footer class="bg-gray-900 py-8 text-center text-gray-400 rounded-t-lg shadow-inner mt-8">
  <div class="container mx-auto px-4">
    <p>© 2012 - <span id="current-year-infra"></span> Arcator.co.uk. All rights reserved.</p>
    <p class="mt-2">Made with ❤️ for the Minecraft Community.</p>
    <div class="flex flex-wrap justify-center space-x-6 mt-4">
      <a href="privacy.html" class="hover:text-white transition duration-300 ease-in-out">Privacy Policy</a>
      <a href="terms.html" class="hover:text-white transition duration-300 ease-in-out">Terms of Service</a>
      <a href="https://wiki.arcator.co.uk/" target="_blank" rel="noopener noreferrer" class="hover:text-white transition duration-300 ease-in-out">Wiki</a>
      <a href="infrastructure.html" class="hover:text-white text-purple-400 transition duration-300 ease-in-out">Infrastructure</a>
      <a href="admin_and_dev.html" class="hover:text-white transition duration-300 ease-in-out">Admin & Dev</a>
    </div>
  </div>
</footer>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
  import { getAuth, onAuthStateChanged, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
  import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
  import { setupThemesFirebase, applyTheme, getAvailableThemes } from './themes.js';


  // Firebase configuration object
  const firebaseConfig = {
    apiKey: "AIzaSyCP5Zb1CRermAKn7p_S30E8qzCbvsMxhm4",
    authDomain: "arcator-web.firebaseapp.com",
    projectId: "arcator-web",
    storageBucket: "arcator-web.firebasestorage.app",
    messagingSenderId: "1033082068049",
    appId: "1:1033082068049:web:dd154c8b188bde1930ec70",
    measurementId: "G-DJXNT1L7CM"
  };

  const appId = "arcator-web"; // Explicitly set appId

  let app;
  let auth;
  let db;
  let isFirebaseInitialized = false;

  const DEFAULT_PROFILE_PIC = 'https://placehold.co/32x32/1F2937/E5E7EB?text=AV'; // Default placeholder
  const DEFAULT_THEME_NAME = 'dark'; // Default theme name

  // Initialize Firebase
  try {
    app = initializeApp(firebaseConfig);
    auth = getAuth(app);
    db = getFirestore(app);
    isFirebaseInitialized = true;
    console.log("Firebase initialized successfully in infrastructure.html.");
    setupThemesFirebase(db, auth, appId); // Pass auth to themes.js
  } catch (e) {
    console.error("Error initializing Firebase in infrastructure.html:", e);
  }

  // Function to load the navigation bar
  async function loadNavbar() {
    const navbarPlaceholder = document.getElementById('navbar-placeholder');
    if (navbarPlaceholder) {
      try {
        const response = await fetch('navbar.html');
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        const navbarHtml = await response.text();
        navbarPlaceholder.innerHTML = navbarHtml;

        // After navbar is loaded, set up auth state listener for navbar elements
        if (isFirebaseInitialized) {
          onAuthStateChanged(auth, async (user) => {
            const navbarUserIcon = document.getElementById('navbar-user-profile-pic');
            const navbarUserDisplayName = document.getElementById('navbar-user-display-name');
            const navbarUserSettingsLink = document.getElementById('navbar-user-settings-link');
            const navbarSigninLink = document.getElementById('navbar-signin-link');

            if (user) {
              const userProfile = await getUserProfileFromFirestore(user.uid);
              const displayName = userProfile?.displayName || user.displayName || 'Settings';
              const photoURL = userProfile?.photoURL || user.photoURL || DEFAULT_PROFILE_PIC;
              const themePreference = userProfile?.themePreference || DEFAULT_THEME_NAME;

              if (navbarUserIcon && navbarUserDisplayName && navbarUserSettingsLink) {
                navbarUserIcon.src = photoURL;
                navbarUserDisplayName.textContent = displayName;
                navbarUserSettingsLink.style.display = 'flex'; // Show profile link
              }
              if (navbarSigninLink) {
                navbarSigninLink.style.display = 'none'; // Hide sign-in link
              }
              applyTheme(themePreference); // Apply user's theme
            } else {
              // If not logged in, ensure profile link is hidden and sign-in is shown
              if (navbarUserSettingsLink) {
                navbarUserSettingsLink.style.display = 'none';
              }
              if (navbarSigninLink) {
                navbarSigninLink.style.display = 'flex'; // Show sign-in link
              }
              applyTheme(DEFAULT_THEME_NAME); // Apply default theme
              // Attempt anonymous sign-in if not already authenticated
              if (typeof __initial_auth_token !== 'undefined' && !user) {
                signInAnonymously(auth).then(() => {
                  console.log("DEBUG: Signed in anonymously on infrastructure.html (Canvas env).");
                }).catch(error => {
                  console.error("ERROR: Anonymous sign-in failed during navbar load on infrastructure.html:", error);
                });
              } else if (!user && !__initial_auth_token) {
                signInAnonymously(auth)
                  .then(() => console.log("DEBUG: Signed in anonymously (no custom token) on infrastructure.html."))
                  .catch((anonError) => console.error("ERROR: Error signing in anonymously on infrastructure.html:", anonError));
              }
            }
          });
        }
      } catch (error) {
        console.error("Failed to load navigation bar:", error);
      }
    }
  }

  /**
   * Fetches user profile data from Firestore.
   * @param {string} uid - The user's UID.
   * @returns {Promise<Object|null>} - User profile data or null if not found.
   */
  async function getUserProfileFromFirestore(uid) {
    if (!db) {
      console.error("Firestore DB not initialized for getUserProfileFromFirestore.");
      return null;
    }
    const userDocRef = doc(db, `artifacts/${appId}/public/data/user_profiles`, uid);
    try {
      const docSnap = await getDoc(userDocRef);
      if (docSnap.exists()) {
        return docSnap.data();
      }
    } catch (error) {
      console.error("Error fetching user profile from Firestore:", error);
    }
    return null;
  }

  // Get current year for footer
  window.onload = function() {
    loadNavbar();
    document.getElementById('current-year-infra').textContent = new Date().getFullYear();
  };
</script>
</body>
</html>
